!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).z={})}(this,(function(e){"use strict";var t=Object.defineProperty,n=(e,n,r)=>((e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r)(e,"symbol"!=typeof n?n+"":n,r);function r(e,t){e.innerHTML="",e.appendChild(t())}function i(e="",t=6){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="1234567890";let i=e;const o=Date.now(),a=n.charAt(Math.floor(26*Math.random())),l=r.charAt(Math.floor(10*Math.random()));if(!e)for(let s=0;s<t;s++)i+=n.charAt(Math.floor(26*Math.random()));return i+=`_${o}${a}${l}`,i}const o=/* @__PURE__ */new Map;let a;var l;var s="http://www.w3.org/1999/xhtml",c="undefined"==typeof document?void 0:document,d=!!c&&"content"in c.createElement("template"),u=!!c&&c.createRange&&"createContextualFragment"in c.createRange();function f(e){return e=e.trim(),d?function(e){var t=c.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(e):u?function(e){return l||(l=c.createRange()).selectNode(c.body),l.createContextualFragment(e).childNodes[0]}(e):function(e){var t=c.createElement("body");return t.innerHTML=e,t.childNodes[0]}(e)}function h(e,t){var n,r,i=e.nodeName,o=t.nodeName;return i===o||(n=i.charCodeAt(0),r=o.charCodeAt(0),n<=90&&r>=97?i===o.toUpperCase():r<=90&&n>=97&&o===i.toUpperCase())}function m(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var p={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}m(e,t,"selected")},INPUT:function(e,t){m(e,t,"checked"),m(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var i=r.nodeValue;if(i==n||!n&&i==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,i=-1,o=0,a=e.firstChild;a;)if("OPTGROUP"===(r=a.nodeName&&a.nodeName.toUpperCase()))a=(n=a).firstChild;else{if("OPTION"===r){if(a.hasAttribute("selected")){i=o;break}o++}!(a=a.nextSibling)&&n&&(a=n.nextSibling,n=null)}e.selectedIndex=i}}};function b(){}function v(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var g,y=(g=function(e,t){var n,r,i,o,a=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var l=a.length-1;l>=0;l--)r=(n=a[l]).name,i=n.namespaceURI,o=n.value,i?(r=n.localName||r,e.getAttributeNS(i,r)!==o&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(i,r,o))):e.getAttribute(r)!==o&&e.setAttribute(r,o);for(var s=e.attributes,c=s.length-1;c>=0;c--)r=(n=s[c]).name,(i=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(i,r)||e.removeAttributeNS(i,r)):t.hasAttribute(r)||e.removeAttribute(r)}},function(e,t,n){if(n||(n={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var r=t;(t=c.createElement("html")).innerHTML=r}else t=f(t);else 11===t.nodeType&&(t=t.firstElementChild);var i=n.getNodeKey||v,o=n.onBeforeNodeAdded||b,a=n.onNodeAdded||b,l=n.onBeforeElUpdated||b,d=n.onElUpdated||b,u=n.onBeforeNodeDiscarded||b,m=n.onNodeDiscarded||b,y=n.onBeforeElChildrenUpdated||b,E=n.skipFromChildren||b,T=n.addChild||function(e,t){return e.appendChild(t)},C=!0===n.childrenOnly,S=/* @__PURE__ */Object.create(null),N=[];function A(e){N.push(e)}function w(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var r=void 0;t&&(r=i(n))?A(r):(m(n),n.firstChild&&w(n,t)),n=n.nextSibling}}function L(e,t,n){!1!==u(e)&&(t&&t.removeChild(e),m(e),w(e,n))}function x(e){a(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=i(t);if(r){var o=S[r];o&&h(t,o)?(t.parentNode.replaceChild(o,t),M(o,t)):x(t)}else x(t);t=n}}function M(e,t,n){var r=i(t);if(r&&delete S[r],!n){var a=l(e,t);if(!1===a)return;if(a instanceof HTMLElement&&(e=a),g(e,t),d(e),!1===y(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,a,l,s,d=E(e,t),u=t.firstChild,f=e.firstChild;e:for(;u;){for(l=u.nextSibling,n=i(u);!d&&f;){if(a=f.nextSibling,u.isSameNode&&u.isSameNode(f)){u=l,f=a;continue e}r=i(f);var m=f.nodeType,b=void 0;if(m===u.nodeType&&(1===m?(n?n!==r&&((s=S[n])?a===s?b=!1:(e.insertBefore(s,f),r?A(r):L(f,e,!0),r=i(f=s)):b=!1):r&&(b=!1),(b=!1!==b&&h(f,u))&&M(f,u)):3!==m&&8!=m||(b=!0,f.nodeValue!==u.nodeValue&&(f.nodeValue=u.nodeValue))),b){u=l,f=a;continue e}r?A(r):L(f,e,!0),f=a}if(n&&(s=S[n])&&h(s,u))d||T(e,s),M(s,u);else{var v=o(u);!1!==v&&(v&&(u=v),u.actualize&&(u=u.actualize(e.ownerDocument||c)),T(e,u),x(u))}u=l,f=a}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=i(t))?A(n):L(t,e,!0),t=r}}(e,f,r);var g=p[e.nodeName];g&&g(e,t)}(e,t):p.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var n=t.firstChild;n;){var r=i(n);r&&(S[r]=n),e(n),n=n.nextSibling}}(e);var _,O,H=e,D=H.nodeType,P=t.nodeType;if(!C)if(1===D)1===P?h(e,t)||(m(e),H=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(e,(_=t.nodeName,(O=t.namespaceURI)&&O!==s?c.createElementNS(O,_):c.createElement(_)))):H=t;else if(3===D||8===D){if(P===D)return H.nodeValue!==t.nodeValue&&(H.nodeValue=t.nodeValue),H;H=t}if(H===t)m(e);else{if(t.isSameNode&&t.isSameNode(H))return;if(M(H,t,C),N)for(var U=0,I=N.length;U<I;U++){var R=S[N[U]];R&&L(R,R.parentNode,!1)}}return!C&&H!==e&&e.parentNode&&(H.actualize&&(H=H.actualize(e.ownerDocument||c)),e.parentNode.replaceChild(H,e)),H});const E=/* @__PURE__ */new Set,T=/* @__PURE__ */new Set;let C=!1,S=[];function N(e,t,n){if(e.nodeType===Node.TEXT_NODE)return{type:"#text",content:e.textContent.trim(),attributes:{},children:[],elements:n};if(!(null==e?void 0:e.tagName))return null;const r=e.tagName.toLowerCase(),i=function(e,t,n){const r={};return Array.from(e.attributes).forEach((e=>{const i=e.value.trim(),o=t.find((e=>e.name===i));if(o)r[e.name]=o.fn;else{const t=n.find((e=>e.name===i));r[e.name]=t?t.name:e.value}})),r}(e,t,n);return{type:r,content:Array.from(e.childNodes).filter((e=>e.nodeType===Node.TEXT_NODE)).map((e=>e.textContent.trim())).join(""),attributes:i,children:Array.from(e.childNodes).filter((e=>e.nodeType===Node.ELEMENT_NODE)).map((e=>N(e,t,n))),elements:n}}function A(e,t){const{type:n,content:r,attributes:o,children:a,elements:l}=e;if("#text"===n)return document.createTextNode(r);const s=document.createElement(n);if(!s.hasAttribute("_id")){const e=i("ELEMENT");s.setAttribute("_id",e),t&&t.size>0&&t.forEach((t=>t.elementInDom=e))}r&&(s.textContent=r);for(const[i,c]of Object.entries(o)){if("ref"===i){S.find((e=>e.ref===c))?(S=S.filter((e=>e.ref!==c)),S.push({ref:c,element:s})):S.push({ref:c,element:s})}if(i.startsWith("on")){const e=i.slice(2).toLowerCase();"change"===e?s.addEventListener("input",c):s.addEventListener(e,c)}else s.setAttribute(i,c)}return a&&a.forEach((e=>{const t=A(e);s.appendChild(t)})),Array.from(s.querySelectorAll("div[_id]")).forEach((e=>{const t=e.getAttribute("_id"),n=l.find((e=>e.name===t));n&&e.replaceWith(n.element)})),s}window.addEventListener("DOMContentLoaded",(()=>(T.forEach((e=>{if("LIST"===e.type){let t=function(e){let t=document.querySelector(`[ref="${e}"]`)||null;return t}(e.ref);t&&e.fn(t)}})),void Array.from(document.querySelectorAll("div[list]")).forEach((e=>{e.remove()})))));const{channels:w}=new function(e={}){let t=[],n=e.plugins||[],r={};n.length>0&&n.forEach((e=>{const t=e.name||"UnNamedPlugin";r[t]=e}));const i=e=>t[e].state,o=(e,n)=>{const r=t[e];let i=r.state;for(const t of r.activePlugins)if(t.getter){const e=t.getter.method(i,t.getter.options);i={...i,...e}}return((e,n)=>{((null==n?void 0:n.auto)??1)&&a(e,(()=>t[e].state));return t[e].state})(e,n)},a=(e,n)=>{t[e].subscribers.add(n)},l=e=>{t[e].subscribers.forEach((n=>n(t[e].state)))},s=(e,t)=>{let n=i(e),r=t;return"function"==typeof t&&(r=t(n)),c(e,r)},c=(e,n)=>{let r=t[e].state;return t[e].state=n,t[e].history.length<=10||(t[e].history=[]),t[e].history.push(r),l(e),t[e].state},d=async(e,n)=>{const r=t[e],o=u(r.middleWares,e);let a=i(e),l=n;"function"==typeof n&&(l=n(a));try{const t=await o(l);return c(e,t)}catch(s){}},u=(e,t)=>e.reduce(((e,t,n)=>async(n,...r)=>{try{const i=await e(n,...r);return await t(i,...r)}catch(i){throw i}}));return{channels:{getChannels:()=>t,getChannel:e=>t[e]?t[e]:null,addChannel:(e,n={})=>(t[e]={name:e,activePlugins:[],subscribers:/* @__PURE__ */new Set,state:n,middleWares:[],history:[],setState:n=>((e,n)=>{const r=t[e];let o=i(e),a=n;"function"==typeof n&&(a=n(o));for(const t of r.activePlugins)t.setter&&(a=t.setter.method(a,t.setter.options));return s(e,a)})(e,n),setStateAsync:t=>d(e,t),getState:t=>o(e,t),getHistory:()=>(e=>t[e].history)(e),addMiddleWares:(...n)=>((e,...n)=>{let r=t[e].middleWares;return t[e].middleWares=[...r,...n],t[e].middleWares})(e,...n),subscribe:t=>a(e,t),unSubscribe:n=>((e,n)=>{t[e].subscribers.delete(n)})(e,n),notifySubscribers:e=>l(e),usePlugin:n=>((e,n)=>{const i=r[n]||null;i&&(t[e].activePlugins.push(i),(i.exposes||[]).forEach((n=>{t[e][n.name]=(...r)=>n.method(t[e].state,...r)})))})(e,n)},t[e]),removeChannel:e=>{if(t[e]){const n=Object.keys(t).filter((t=>t!==e)).reduce(((e,n)=>(e[n]=t[n],e)),{});t=n}return t}}}},L=w;class x extends HTMLElement{constructor(){super(...arguments),n(this,"_handleClick",(e=>{e.preventDefault();const t=this.getAttribute("to")||"/",n=this.getAttribute("target"),r=new CustomEvent("z-navigate",{bubbles:!0,detail:{path:t,target:n}});this.dispatchEvent(r)}))}connectedCallback(){this.addEventListener("click",this._handleClick),this.style.cursor="pointer"}disconnectedCallback(){this.removeEventListener("click",this._handleClick)}}function M(e={}){const t=e.parent||document.body,n=e.routes||[],i=e.initialDelay||0,o=(e,i={})=>{const o=i.target||t,a=(e=>{const t=e.startsWith("/")?e:`/${e}`;if(t.endsWith("/index.html"))return n.find((e=>"/"===e.route));const r=n.find((e=>e.route===t));return r||n.find((e=>"/*"===e.route))})(e),l=i.component||(null==a?void 0:a.component);if(l){let t=e.endsWith("/index.html")?"/":e;t=t.startsWith("/")?t:`/${t}`,i.replaceState?history.replaceState({},"",t):history.pushState({},"",t),r(o,l)}},a=e=>{const{path:t,target:n}=e.detail;if(l(e.target),n){const e=document.getElementById(n);e&&o(t,{target:e})}else o(t)},l=e=>{t.querySelectorAll("z-link").forEach((t=>{t.classList.toggle("active",t===e)}))},s=()=>{const e=window.location.pathname+window.location.search;o(e,{replaceState:!0})},c=()=>{0!==n.length&&(t.addEventListener("z-navigate",a),window.addEventListener("popstate",s),(()=>{const e=window.location.pathname+window.location.search;o(e,{replaceState:!0})})())};return i>0?setTimeout(c,i):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c(),{history:window.history,location:window.location,goTo:o,goBack:()=>window.history.back(),goForward:()=>window.history.forward(),getParam:e=>{const t=new URLSearchParams(window.location.search);return t.has(e)?t.get(e):null},reloadRouter:c}}customElements.get("z-link")||customElements.define("z-link",x);let _=null,O=null;e.List=function(e){let t=i("LIST");const{ref:n,items:r,render:o}=e;return C=!0,{type:"LIST",ref:n,id:t,fn:e=>{if(e){let t=r;r.value&&(t=r.value),t.forEach(((t,n)=>{const r=o({item:t,index:n});e.innerHtml="",e.appendChild(r)})),C=!1}}}},e.createStore=function(e){let t=i("store",12),n=w.addChannel(t,e);return{id:t,setValue:n.setState,getValue:()=>n.getState(),subscribe:e=>n.subscribe(e),channel:n}},e.css=function(e,...t){a||(a=document.createElement("style"),document.head.appendChild(a));const n=e.reduce(((e,n,r)=>e+n+(t[r]||"")),""),r="css-"+function(e){let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n);return t.toString(36)}(n);if(o.has(r))return o.get(r);const i=`.${r} { ${n} }`;return a.innerHTML+=i,o.set(r,r),r},e.getRef=function(e){let t=null;return S.forEach((n=>{n.ref===e&&(t=n.element)})),t},e.getRootElement=()=>O,e.html=function(e,...t){const n=[],r=[];!C&&E.clear();const o={function:function(e,t){return`__FUNCTION_${t}__`},HTMLElement:l,Text:s,Array:function(e){return e.map((e=>e instanceof HTMLElement?l(e):e instanceof Text?s(e):c(`${e}`))).join("")},default:function(e){return void 0!==e?function(e){if("object"==typeof e&&"LIST"===(null==e?void 0:e.type)){let t=`<div list="${e.id}">list</div>`,n=!1;return T.forEach((t=>{t.ref===e.ref&&t.type===e.type&&(n=!0)})),n||T.add({ref:e.ref,type:e.type,id:e.id,fn:e.fn}),t}return"object"==typeof e&&e.hasOwnProperty("value")?(E.add(e),e.current()):Array.isArray(e)?e.map((e=>c(`${e}`))).join(""):c(`${e}`)}(e):""}},a=e.reduce(((e,n,r)=>{if(r<t.length){const i=t[r],a=function(e){return"function"==typeof e?"function":e instanceof HTMLElement?"HTMLElement":e instanceof Text?"Text":Array.isArray(e)?"Array":"default"}(i);return e+n+(0,o[a])(i,r)}return e+n}),"");function l(e){const t=e.getAttribute("_id")||i("ELEMENT");return e.setAttribute("_id",t),`<div _id="${t}"></div>`}function s(e){return e.textContent}function c(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}t.forEach(((e,t)=>{if("function"==typeof e)n.push({name:`__FUNCTION_${t}__`,fn:e});else if(e instanceof HTMLElement){const t=e.getAttribute("_id")||i("ELEMENT");e.setAttribute("_id",t),r.push({name:t,element:e})}}));return A(N(function(e){const t=new DOMParser;let n;return e.trim().match(/^<(tr|td|th|tbody|thead|tfoot)/i)?(n=t.parseFromString(`<table>${e}</table>`,"text/html"),n.querySelector("table").firstElementChild):(n=t.parseFromString(e,"text/html"),n.body.firstElementChild)}(a),n,r),E)},e.radio=L,e.reactive=function(e){const t=e();return E&&E.size>0&&E.forEach((t=>{t.subscribe((()=>{let n=document.querySelector(`[_id="${t.elementInDom}"]`),r=e();n&&function(e,t,n={}){const r={...n};y(e,t,r)}(n,r)}))})),t},e.render=(e=null,t=[],n=0)=>{if(!e)return;if(0===t.length)return;return r(e,t.find((e=>"/"===e.route)).component),e&&t.length>0&&(O=e,_=new M({routes:t,parent:e,initialDelay:n})),_},e.useEffect=function(e,t){0!==t.length?t.forEach((t=>{let n=L.getChannel(t.id);n&&n.subscribe(e)})):window.addEventListener("DOMContentLoaded",e())},e.useRouter=()=>_,e.useState=function(e){let t=i("state",12),n=w.addChannel(t,e);return[{id:t,current:()=>n.getState(),subscribe:e=>n.subscribe(e),value:n.getState()},n.setState,n]},e.useStore=function(e){return[{id:e.id,current:()=>e.getValue(),subscribe:t=>e.subscribe(t),value:e.getState()},e.setState,e.channel]},e.useSuspense=function(e,t,n={}){const{retry:r=!1,retryDelay:i=1e3,maxRetries:o=3}=n;if(!(t instanceof HTMLElement))throw new Error("Fallback must be an HTML element");const a=document.createElement("div");a.appendChild(t);let l=0;const s=()=>{e().then((e=>{if(!(e instanceof HTMLElement))throw new Error("Suspense content must be a valid HTML element");a.innerHTML="",a.appendChild(e)})).catch((e=>{r&&l<o&&(l++,setTimeout(s,i))}))};return s(),a},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
